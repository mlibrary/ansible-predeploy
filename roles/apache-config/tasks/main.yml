---

- name: Add app host to hosts file.
  hosts: web
  lineinfile:
    dest: /etc/hosts
    state: present
    insertafter: EOF
    line: "{{apache_app_host_priv_ip}} {{apache_app_hostname}}"

- name: Create logging directory for appliacation
  hosts: web
  file:
    path: /var/log/apache2/{{apache_app_name}}
    state: directory
    owner: root
    group: "{{apache_log_group}}"
    mode: u=rwx,g=rwx,o=rx

- name: Add site config to apache config staging area
  template:
    src:   site.conf.j2 
    dest:  "{{apache_staging_prefix}}/etc/apache2/sites-available/{{apache_app_name}}.conf"
    owner: root
    group: root
    mode:  u=rw,g=r,o=r

- name: Enable site config in apache config staging area
  file:
    state: link
    src: "../sites-available/{{apache_app_name}}.conf"
    dest: "{{apache_staging_prefix}}/etc/apache2/sites-enabled/{{apache_app_name}}.conf"
